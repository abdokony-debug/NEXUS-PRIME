name: WAHAB AI Registration System
on:
  workflow_dispatch:
    inputs:
      mode:
        description: 'Processing mode'
        required: true
        default: 'intelligent'
        type: choice
        options:
          - intelligent
          - fast
          - stealth
      max_accounts:
        description: 'Maximum accounts per platform'
        required: true
        default: '10'
        type: string
      use_proxies:
        description: 'Use rotating proxies'
        required: false
        default: 'false'
        type: boolean

jobs:
  intelligent-registration:
    runs-on: ubuntu-22.04
    timeout-minutes: 120
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install AI System Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            libnss3 \
            libnspr4 \
            libatk1.0-0 \
            libatk-bridge2.0-0 \
            libcups2 \
            libdrm2 \
            libdbus-1-3 \
            libxkbcommon0 \
            libatspi2.0-0 \
            libxcomposite1 \
            libxdamage1 \
            libxfixes3 \
            libxrandr2 \
            libgbm1 \
            libpango-1.0-0 \
            libcairo2 \
            libasound2 \
            fonts-liberation \
            libappindicator3-1 \
            xdg-utils \
            wget \
            ca-certificates \
            python3 \
            python3-pip

          # ØªØ«Ø¨ÙŠØª Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
          pip3 install tensorflow scikit-learn nltk

          # ØªØ«Ø¨ÙŠØª ØªØ¨Ø¹ÙŠØ§Øª Node.js
          npm ci --production

      - name: Train AI Model
        run: |
          echo "ðŸ§  ØªØ¯Ø±ÙŠØ¨ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ..."
          npm run train
          echo "âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ¯Ø±ÙŠØ¨"

      - name: Run Intelligent Registration
        run: |
          echo "ðŸš€ ØªØ´ØºÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ"
          echo "Mode: ${{ github.event.inputs.mode }}"
          echo "Max accounts: ${{ github.event.inputs.max_accounts }}"
          echo "Use proxies: ${{ github.event.inputs.use_proxies }}"
          
          node src/index.js \
            --mode ${{ github.event.inputs.mode }} \
            --max-accounts ${{ github.event.inputs.max_accounts }} \
            --proxies ${{ github.event.inputs.use_proxies }}
        env:
          GOOGLE_SHEET_URL: ${{ secrets.GOOGLE_SHEET_URL }}
          GOOGLE_CLIENT_EMAIL: ${{ secrets.GOOGLE_CLIENT_EMAIL }}
          GOOGLE_PRIVATE_KEY: ${{ secrets.GOOGLE_PRIVATE_KEY }}
          GOOGLE_SHEET_ID: ${{ secrets.GOOGLE_SHEET_ID }}
          CAPTCHA_API_KEY: ${{ secrets.CAPTCHA_API_KEY }}
          TEMP_EMAIL_API: ${{ secrets.TEMP_EMAIL_API }}
          PROXY_API_KEY: ${{ secrets.PROXY_API_KEY }}
          
          # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
          AI_MODE: 'adaptive'
          LEARNING_RATE: '0.1'
          MAX_RETRIES: '3'
          HUMAN_LIKE_DELAY: 'true'
          TAKE_SCREENSHOTS: 'true'

      - name: Generate AI Report
        if: always()
        run: |
          echo "ðŸ“Š Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ..."
          node src/utils/reporter.js
          cat ai-report.md

      - name: Upload Results
        uses: actions/upload-artifact@v4
        with:
          name: wahab-ai-results-${{ github.run_id }}
          path: |
            screenshots/
            logs/
            ai-report.md
            accounts.db
          retention-days: 30
