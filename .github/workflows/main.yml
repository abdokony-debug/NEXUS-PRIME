name: Wahab Stealth v10.2
on:
  schedule:
    - cron: '*/30 * * * *'
  workflow_dispatch:

jobs:
  stealth:
    runs-on: ubuntu-24.04
    timeout-minutes: 25
    steps:
    - uses: actions/checkout@0ad4b8fadaa221de15dcec353f45205ec38ea70b
    
    - uses: actions/setup-node@1e60f620b9541f168136bd8d9b1115e8497a4508
      with:
        node-version: 20
        cache: 'npm'
    
    - name: Install system deps
      run: |
        sudo apt-get update -y
        sudo apt-get install -y libnss3 libatk-bridge2.0-0 libxss1 libasound2 libgbm1
        
    - name: npm install
      run: npm install
      
    - name: Install Playwright Chromium
      run: npx playwright install --with-deps chromium
      
    - name: Run engine
      run: npm start
      env:
        SHEET_URL: ${{ secrets.SHEET_URL }}
        
    - uses: actions/upload-artifact@0b7f0a8d9377b7f7dd32b4fd8d0d095a4e3a2002
      if: always()
      with:
        name: wahab-results-${{ github.run_id }}
        path: |
          evidences/
          *.txt
